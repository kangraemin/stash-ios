# Worklog: Stash — 2026-02-22

---

## 12:32

### 요청사항
- Step 3.1: Share Extension에서 URL 수신 로직 구현

### 작업 내용
- URLExtractor enum 생성 (parseURL, extractURL 메서드)
- ShareViewController를 SLComposeServiceViewController → UIViewController로 변경
- UTType.url 우선, UTType.plainText 폴백 방식으로 URL 추출
- URLExtractorTests 작성 (정상 URL, 텍스트 내 URL, 빈 문자열 등 8개 테스트)
- Xcode 프로젝트에 파일 추가 (Stash + StashShareExtension 양쪽 타겟)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj               | 18 ++++++++
 Stash/Shared/AppGroup/URLExtractor.swift      | 60 +++++++++++++++++++++++++
 StashShareExtension/ShareViewController.swift | 30 +++----------
 StashTests/Shared/URLExtractorTests.swift     | 64 +++++++++++++++++++++++++++
 4 files changed, 149 insertions(+), 23 deletions(-)
```

---

## 12:40

### 요청사항
- Step 3.4: MetadataClient Protocol 정의

### 작업 내용
- ContentMetadata 도메인 모델 생성 (title, description, imageURL, siteName — 모두 Optional)
- MetadataClient DependencyKey 생성 (fetch 클로저, testValue mock 포함)
- ContentClient에 update 클로저 추가
- ContentModelActor에 update() 메서드 구현
- ContentMapper.encodeMetadata 접근 수준 private → internal 변경
- MetadataClientTests 작성 (testValue mock 반환, 기본값 nil, Equatable 검증)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj             | 12 ++++++++
 Stash/Data/Clients/ContentClientLive.swift  | 13 +++++++++
 Stash/Data/Mappers/ContentMapper.swift      |  2 +-
 Stash/Domain/Models/ContentMetadata.swift   |  8 ++++++
 Stash/Domain/Services/ContentClient.swift   |  7 +++--
 Stash/Domain/Services/MetadataClient.swift  | 31 +++++++++++++++++++++
 StashTests/Domain/MetadataClientTests.swift | 43 +++++++++++++++++++++++++++++
 7 files changed, 113 insertions(+), 3 deletions(-)
```

---

## 12:39

### 요청사항
- Step 3.2: Share Extension SwiftData 저장 구현

### 작업 내용
- ShareExtensionSaver enum 생성 (App Group 컨테이너 경량 SwiftData 직접 접근)
- ShareViewController에서 URL 추출 후 ShareExtensionSaver.save() 호출 연결
- 도메인/데이터 파일 5개를 StashShareExtension 타겟에 추가
- ShareExtensionSaverTests 작성 (저장/조회, ContentType 분류, title=host, 빈 metadata 등 5개 테스트)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj                  | 20 ++++++
 Stash/Shared/AppGroup/ShareExtensionSaver.swift  | 31 +++++++++
 StashShareExtension/ShareViewController.swift    |  9 ++-
 StashTests/Shared/ShareExtensionSaverTests.swift | 80 ++++++++++++++++++++++++
 4 files changed, 139 insertions(+), 1 deletion(-)
```

---

## 12:42

### 요청사항
- Step 3.5: MetadataClient liveValue 구현

### 작업 내용
- OGTagParser enum 생성 (URLSession HTML 다운로드 + 정규식 OG 태그 파싱)
- property/name 속성, content 순서 역전, 작은따옴표, 대소문자 혼용 모두 지원
- MetadataClient liveValue에서 OGTagParser.parse(from:) 연결
- OGTagParserTests 작성 (전체 태그, 일부 누락, 빈 HTML, 역순, name 속성, 잘못된 태그, 대소문자, 작은따옴표 등 8개 테스트)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj             |   8 ++
 Stash/Data/Clients/MetadataClientLive.swift |  43 +++++++++
 Stash/Domain/Services/MetadataClient.swift  |   3 +-
 StashTests/Data/OGTagParserTests.swift      | 130 ++++++++++++++++++++++++++++
 4 files changed, 182 insertions(+), 2 deletions(-)
```

---

## 12:45

### 요청사항
- Step 3.3: 저장 완료 피드백 UI 구현

### 작업 내용
- ShareViewController에 UIKit 토스트 UI 추가
- 성공: 초록 캡슐 + 체크마크 + "저장 완료", 실패: 빨간 캡슐 + X + "저장 실패"
- 스프링 애니메이션으로 표시 후 1초 뒤 페이드아웃 → Extension 종료
- URL 추출/저장 결과에 따른 성공/실패 분기 처리

### 변경 통계
```
 StashShareExtension/ShareViewController.swift | 83 ++++++++++++++++++++++++---
 1 file changed, 75 insertions(+), 8 deletions(-)
```

---

## 12:50

### 요청사항
- Step 3.6: 미처리 콘텐츠 메타데이터 자동 업데이트

### 작업 내용
- HomeFeature에 metadataClient 의존성 추가
- contentsLoaded 시 needsMetadataUpdate 항목 자동 필터링 및 메타데이터 fetch/update
- State에 isUpdatingMetadata 추가, Action에 metadataUpdateCompleted/Failed 추가
- 개별 실패 무시, 나머지 계속 처리
- TestStore 테스트 3개 추가 (자동 업데이트, 이미 있으면 skip, 실패 시 skip)

### 변경 통계
```
 Stash/Features/Home/HomeFeature.swift      |  49 ++++++++++++-
 StashTests/Features/HomeFeatureTests.swift | 108 +++++++++++++++++++++++++++--
 2 files changed, 150 insertions(+), 7 deletions(-)
```
---

## 13:05

### 요청사항
- Step 4.1: DetailFeature Reducer 생성
- Step 4.4: 딥링크 URL 생성 로직

### 작업 내용
- DetailFeature Reducer 생성 (State: content, alert / Action: open, delete, alert, delegate)
- Delegate Action으로 contentDeleted(UUID) 정의 (부모 알림용)
- AlertState로 삭제 확인 다이얼로그 구성
- DeepLinkBuilder enum 생성 (ContentType별 딥링크 URL 생성)
- 네이버맵 nmap:// URL scheme 변환, 나머지는 Universal Link 사용
- canDeepLink() 헬퍼로 딥링크 가능 여부 판단

### 변경 통계
```
 Stash/Domain/ContentParsing/DeepLinkBuilder.swift | 37 ++++++++++++++
 Stash/Features/Detail/DetailFeature.swift         | 61 +++++++++++++++++++++++
 2 files changed, 98 insertions(+)
```

---

## 13:07

### 요청사항
- Step 4.1, 4.4 Lead 스펙에 맞게 수정 + 테스트 추가

### 작업 내용
- DetailFeature: Alert.confirmDelete로 변경, body 간소화 (기본 구조만)
- DeepLinkBuilder: canDeepLink 항상 true, naverMapDeepLink Optional 반환
- DeepLinkBuilderTests 추가 (9개 테스트: 각 ContentType URL, nmap scheme, canDeepLink)

### 변경 통계
```
 Stash/Domain/ContentParsing/DeepLinkBuilder.swift  |  6 +--
 Stash/Features/Detail/DetailFeature.swift          | 20 ++-----
 StashTests/Domain/DeepLinkBuilderTests.swift       | 76 ++++++++++++++++++++++
 3 files changed, 83 insertions(+), 19 deletions(-)
```

---

## 12:54 (auto)

### 작업 내용
- docs: Phase 3 완료 상태로 PHASES.md 업데이트

### 작업 내용
- feat: DetailView UI, 네비게이션, 딥링크 실행 구현
- HomeFeature StackState 네비게이션, DetailView 상세 화면, OpenURLClient 딥링크 실행

### 작업 내용
- chore: Phase 4 신규 파일 Xcode 프로젝트 등록
- DetailFeature, DetailView, DeepLinkBuilder, OpenURLClient, DeepLinkBuilderTests 추가

### 변경된 파일 (1개)
```
docs/PHASES.md
```

### 변경 통계
```
 docs/PHASES.md | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
```

---

## 13:10

### 요청사항
- Step 4.2: HomeFeature → Detail 네비게이션
- Step 4.3: DetailView UI
- Step 4.5: 딥링크 실행

### 작업 내용
- HomeFeature에 Path enum (StackState) + contentCardTapped Action 추가
- HomeView에 NavigationStack path 바인딩 + destination 분기 추가
- DetailView 생성 (썸네일, 제목, 도메인, 날짜, 요약, 원본 열기/삭제 버튼)
- OpenURLClient DependencyKey 생성 (UIApplication.shared.open 래핑)
- DetailFeature에 openButtonTapped → DeepLinkBuilder + OpenURLClient 연결

### 변경 통계
```
 Stash/Domain/Services/OpenURLClient.swift |  26 +++++++
 Stash/Features/Detail/DetailFeature.swift |   9 ++-
 Stash/Features/Detail/DetailView.swift    | 119 ++++++++++++++++++++++++++++++
 Stash/Features/Home/HomeFeature.swift     |  15 ++++
 Stash/Features/Home/HomeView.swift        |  14 +++-
 5 files changed, 180 insertions(+), 3 deletions(-)
```

---

## 14:37 (auto)

### 작업 내용
- fix: HomeFeature onAppear dead code 복원 및 Equatable 수동 구현
- onAppear에서 fetch 호출이 dead code로 빠진 버그 수정, StackState Equatable 합성 실패 해결

### 변경 파일
- `Stash/Features/Home/HomeFeature.swift`

---

## 14:50

### 요청사항
- Step 4.6: 콘텐츠 삭제 기능
- Step 4.7: 홈 목록 스와이프 삭제

### 작업 내용
- DetailFeature: deleteButtonTapped → AlertState 삭제 확인 다이얼로그 표시
- AlertState confirmDelete → contentClient.delete 호출 → delegate(.contentDeleted) 전송
- HomeFeature: delegate 처리로 path pop + contents/filteredContents에서 제거
- HomeFeature: swipeDeleteTapped Action 추가 → contentClient.delete + 목록 제거
- HomeView: 카드에 contextMenu 삭제 버튼 추가

### 작업 내용
- feat: 콘텐츠 삭제 기능 및 홈 목록 삭제 구현
- DetailFeature: 삭제 Alert 확인 → contentClient.delete → delegate
- HomeFeature: delegate 처리 + swipeDeleteTapped 액션 추가
- HomeView: contextMenu 삭제 버튼 추가

### 작업 내용
- docs: Phase 4 완료 및 Phase 5 상세 Step 설계
- Phase 4 상태를 완료로 업데이트하고, Phase 5 검색 기능의 8개 Step을 상세 설계

### 변경 파일
- `Stash/Features/Detail/DetailFeature.swift`: 삭제 Alert + confirmDelete 로직 구현
- `Stash/Features/Home/HomeFeature.swift`: contentDeleted delegate 처리 + swipeDeleteTapped 추가
- `Stash/Features/Home/HomeView.swift`: contextMenu 삭제 버튼 추가

---

## 14:46 (auto)

### 작업 내용
- feat: SearchClient 및 EmbeddingClient Protocol 정의
- 검색/임베딩 DependencyKey 정의, testValue mock 포함

### 작업 내용
- feat: 키워드 검색 liveValue 구현
- localizedStandardContains 기반 키워드 검색 구현

### 변경 파일
- `Stash.xcodeproj/project.pbxproj`
- `Stash/Domain/Services/EmbeddingClient.swift`
- `Stash/Domain/Services/SearchClient.swift`

---

## 16:01 (auto)

### 작업 내용
- feat: SearchClientLive 프로젝트 연결 및 키워드 검색 활성화
- SearchClientLive.swift를 Xcode 프로젝트에 추가하고
- SearchClient의 unimplemented liveValue를 제거하여
- 키워드 검색 기능을 실제로 사용 가능하게 함

### 변경 파일
- `Stash.xcodeproj/project.pbxproj`
- `Stash/Domain/Services/SearchClient.swift`

---

## 16:04 (auto)

### 작업 내용
- feat: HomeFeature 검색 연동 및 검색바 UI 추가
- - searchQuery State, searchQueryChanged Action, 300ms 디바운스 구현
- - HomeView에 .searchable 검색바 추가
- - 검색 결과와 필터가 함께 적용되도록 구현
- - 빈 검색어, 검색 결과, 필터+검색 조합 테스트 추가

### 변경 파일
- `Stash/Features/Home/HomeFeature.swift`
- `Stash/Features/Home/HomeView.swift`
- `StashTests/Features/HomeFeatureTests.swift`

---

## 17:19 (auto)

### 작업 내용
- feat: NLEmbedding 기반 EmbeddingClient liveValue 구현
- NaturalLanguage 프레임워크의 sentenceEmbedding API를 사용하여
- 한국어/영어 문장 임베딩 벡터 생성 구현

### 변경 파일
- `Stash.xcodeproj/project.pbxproj`
- `Stash/Domain/Services/EmbeddingClient.swift`
- `Stash/ML/EmbeddingService/EmbeddingClientLive.swift`

---

## 17:22 (auto)

### 작업 내용
- feat: SDContent에 embeddingData 필드 추가 및 메타데이터 업데이트 시 임베딩 저장
- SDContent, SavedContent, ContentMapper에 임베딩 벡터 지원 추가.
- 메타데이터 자동 업데이트 시 EmbeddingClient로 임베딩도 함께 생성하여 저장.

### 변경 파일
- `Stash/Data/Clients/ContentClientLive.swift`
- `Stash/Data/Mappers/ContentMapper.swift`
- `Stash/Data/SwiftData/SDContent.swift`
- `Stash/Domain/Models/SavedContent.swift`
- `Stash/Features/Home/HomeFeature.swift`
- `StashTests/Features/HomeFeatureTests.swift`

---

## 17:25 (auto)

### 변경 파일
- `Stash.xcodeproj/project.pbxproj`
- `Stash/ML/VectorSearch/VectorSearchService.swift`
- `StashTests/ML/VectorSearchServiceTests.swift`


# Worklog: Stash — 2026-02-22

---

## 12:32

### 요청사항
- Step 3.1: Share Extension에서 URL 수신 로직 구현

### 작업 내용
- URLExtractor enum 생성 (parseURL, extractURL 메서드)
- ShareViewController를 SLComposeServiceViewController → UIViewController로 변경
- UTType.url 우선, UTType.plainText 폴백 방식으로 URL 추출
- URLExtractorTests 작성 (정상 URL, 텍스트 내 URL, 빈 문자열 등 8개 테스트)
- Xcode 프로젝트에 파일 추가 (Stash + StashShareExtension 양쪽 타겟)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj               | 18 ++++++++
 Stash/Shared/AppGroup/URLExtractor.swift      | 60 +++++++++++++++++++++++++
 StashShareExtension/ShareViewController.swift | 30 +++----------
 StashTests/Shared/URLExtractorTests.swift     | 64 +++++++++++++++++++++++++++
 4 files changed, 149 insertions(+), 23 deletions(-)
```

---

## 12:40

### 요청사항
- Step 3.4: MetadataClient Protocol 정의

### 작업 내용
- ContentMetadata 도메인 모델 생성 (title, description, imageURL, siteName — 모두 Optional)
- MetadataClient DependencyKey 생성 (fetch 클로저, testValue mock 포함)
- ContentClient에 update 클로저 추가
- ContentModelActor에 update() 메서드 구현
- ContentMapper.encodeMetadata 접근 수준 private → internal 변경
- MetadataClientTests 작성 (testValue mock 반환, 기본값 nil, Equatable 검증)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj             | 12 ++++++++
 Stash/Data/Clients/ContentClientLive.swift  | 13 +++++++++
 Stash/Data/Mappers/ContentMapper.swift      |  2 +-
 Stash/Domain/Models/ContentMetadata.swift   |  8 ++++++
 Stash/Domain/Services/ContentClient.swift   |  7 +++--
 Stash/Domain/Services/MetadataClient.swift  | 31 +++++++++++++++++++++
 StashTests/Domain/MetadataClientTests.swift | 43 +++++++++++++++++++++++++++++
 7 files changed, 113 insertions(+), 3 deletions(-)
```

---

## 12:39

### 요청사항
- Step 3.2: Share Extension SwiftData 저장 구현

### 작업 내용
- ShareExtensionSaver enum 생성 (App Group 컨테이너 경량 SwiftData 직접 접근)
- ShareViewController에서 URL 추출 후 ShareExtensionSaver.save() 호출 연결
- 도메인/데이터 파일 5개를 StashShareExtension 타겟에 추가
- ShareExtensionSaverTests 작성 (저장/조회, ContentType 분류, title=host, 빈 metadata 등 5개 테스트)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj                  | 20 ++++++
 Stash/Shared/AppGroup/ShareExtensionSaver.swift  | 31 +++++++++
 StashShareExtension/ShareViewController.swift    |  9 ++-
 StashTests/Shared/ShareExtensionSaverTests.swift | 80 ++++++++++++++++++++++++
 4 files changed, 139 insertions(+), 1 deletion(-)
```

---

## 12:42

### 요청사항
- Step 3.5: MetadataClient liveValue 구현

### 작업 내용
- OGTagParser enum 생성 (URLSession HTML 다운로드 + 정규식 OG 태그 파싱)
- property/name 속성, content 순서 역전, 작은따옴표, 대소문자 혼용 모두 지원
- MetadataClient liveValue에서 OGTagParser.parse(from:) 연결
- OGTagParserTests 작성 (전체 태그, 일부 누락, 빈 HTML, 역순, name 속성, 잘못된 태그, 대소문자, 작은따옴표 등 8개 테스트)

### 변경 통계
```
 Stash.xcodeproj/project.pbxproj             |   8 ++
 Stash/Data/Clients/MetadataClientLive.swift |  43 +++++++++
 Stash/Domain/Services/MetadataClient.swift  |   3 +-
 StashTests/Data/OGTagParserTests.swift      | 130 ++++++++++++++++++++++++++++
 4 files changed, 182 insertions(+), 2 deletions(-)
```

---

## 12:45

### 요청사항
- Step 3.3: 저장 완료 피드백 UI 구현

### 작업 내용
- ShareViewController에 UIKit 토스트 UI 추가
- 성공: 초록 캡슐 + 체크마크 + "저장 완료", 실패: 빨간 캡슐 + X + "저장 실패"
- 스프링 애니메이션으로 표시 후 1초 뒤 페이드아웃 → Extension 종료
- URL 추출/저장 결과에 따른 성공/실패 분기 처리

### 변경 통계
```
 StashShareExtension/ShareViewController.swift | 83 ++++++++++++++++++++++++---
 1 file changed, 75 insertions(+), 8 deletions(-)
```

---

## 12:50

### 요청사항
- Step 3.6: 미처리 콘텐츠 메타데이터 자동 업데이트

### 작업 내용
- HomeFeature에 metadataClient 의존성 추가
- contentsLoaded 시 needsMetadataUpdate 항목 자동 필터링 및 메타데이터 fetch/update
- State에 isUpdatingMetadata 추가, Action에 metadataUpdateCompleted/Failed 추가
- 개별 실패 무시, 나머지 계속 처리
- TestStore 테스트 3개 추가 (자동 업데이트, 이미 있으면 skip, 실패 시 skip)

### 변경 통계
```
 Stash/Features/Home/HomeFeature.swift      |  49 ++++++++++++-
 StashTests/Features/HomeFeatureTests.swift | 108 +++++++++++++++++++++++++++--
 2 files changed, 150 insertions(+), 7 deletions(-)
```
---

## 13:05

### 요청사항
- Step 4.1: DetailFeature Reducer 생성
- Step 4.4: 딥링크 URL 생성 로직

### 작업 내용
- DetailFeature Reducer 생성 (State: content, alert / Action: open, delete, alert, delegate)
- Delegate Action으로 contentDeleted(UUID) 정의 (부모 알림용)
- AlertState로 삭제 확인 다이얼로그 구성
- DeepLinkBuilder enum 생성 (ContentType별 딥링크 URL 생성)
- 네이버맵 nmap:// URL scheme 변환, 나머지는 Universal Link 사용
- canDeepLink() 헬퍼로 딥링크 가능 여부 판단

### 변경 통계
```
 Stash/Domain/ContentParsing/DeepLinkBuilder.swift | 37 ++++++++++++++
 Stash/Features/Detail/DetailFeature.swift         | 61 +++++++++++++++++++++++
 2 files changed, 98 insertions(+)
```

---

## 13:07

### 요청사항
- Step 4.1, 4.4 Lead 스펙에 맞게 수정 + 테스트 추가

### 작업 내용
- DetailFeature: Alert.confirmDelete로 변경, body 간소화 (기본 구조만)
- DeepLinkBuilder: canDeepLink 항상 true, naverMapDeepLink Optional 반환
- DeepLinkBuilderTests 추가 (9개 테스트: 각 ContentType URL, nmap scheme, canDeepLink)

### 변경 통계
```
 Stash/Domain/ContentParsing/DeepLinkBuilder.swift  |  6 +--
 Stash/Features/Detail/DetailFeature.swift          | 20 ++-----
 StashTests/Domain/DeepLinkBuilderTests.swift       | 76 ++++++++++++++++++++++
 3 files changed, 83 insertions(+), 19 deletions(-)
```

---

## 12:54 (auto)

### 작업 내용
- docs: Phase 3 완료 상태로 PHASES.md 업데이트

### 변경된 파일 (1개)
```
docs/PHASES.md
```

### 변경 통계
```
 docs/PHASES.md | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
```

---

## 13:10

### 요청사항
- Step 4.2: HomeFeature → Detail 네비게이션
- Step 4.3: DetailView UI
- Step 4.5: 딥링크 실행

### 작업 내용
- HomeFeature에 Path enum (StackState) + contentCardTapped Action 추가
- HomeView에 NavigationStack path 바인딩 + destination 분기 추가
- DetailView 생성 (썸네일, 제목, 도메인, 날짜, 요약, 원본 열기/삭제 버튼)
- OpenURLClient DependencyKey 생성 (UIApplication.shared.open 래핑)
- DetailFeature에 openButtonTapped → DeepLinkBuilder + OpenURLClient 연결

### 변경 통계
```
 Stash/Domain/Services/OpenURLClient.swift |  26 +++++++
 Stash/Features/Detail/DetailFeature.swift |   9 ++-
 Stash/Features/Detail/DetailView.swift    | 119 ++++++++++++++++++++++++++++++
 Stash/Features/Home/HomeFeature.swift     |  15 ++++
 Stash/Features/Home/HomeView.swift        |  14 +++-
 5 files changed, 180 insertions(+), 3 deletions(-)
```

